---
output: 
  pdf_document:
    latex_engine: xelatex # or lualatex
    keep_tex: true
params:
  Collection_number: NULL
geometry: paperheight=4in,paperwidth=4in,margin=0.1in
header-includes:
  - \pagenumbering{gobble}
  - \usepackage{setspace}
  - \usepackage{wrapfig}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(dpi = 300) 
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```

```{r load library, eval = T}
library(BarnebyLives)

local <- file.path(path.expand('~'), 'Documents', 'assoRted', 'Barneby_Lives_dev', 'LabelStyles')
logopath <- file.path(local, 'logo.png')

record <- read.csv(file.path(local, 'SoS-ExampleCollection.csv')) |> # default feed in the path to your csv. 
  dplyr::filter(Collection_number == params$Collection_number) |>  
  sf::st_drop_geometry() |>
  dplyr::mutate(Project_name = 'Logos', Coordinate_uncertainty = ' +/- 5m')

# escape character columns to ensure characters which interfere with latex
# rendering are escaped. 
char_cols <- sapply(record, is.character)
char_col_names <- names(record)[char_cols]
record[char_col_names] <- lapply(record[char_col_names], escape_latex)
```

\begin{center}
\textbf{\Large `r writer(record[['Project_name']])`}
\end{center}
\begin{flushright}
\uppercase{`r record[['Family']]`}
\end{flushright}

\begingroup
\large
`r writer(paste(record[['Genus']], record[['Epithet']]), italics = TRUE)` `r writer(record[['Binomial_authority']])` `r writer(record[['Infrarank']])` `r writer(record[['Infraspecies']], italics = TRUE)`  `r writer(record[['Infraspecific_authority']])`
\normalsize
\endgroup

\vspace{\fill}

\begingroup
`r record[['Gen']]`. `r writer(record[['Site']])` `r record[['latitude_dd']]` `r record[['longitude_dd']]` (`r record[['Datum']]` `r writer(record[['Coordinate_uncertainty']])`).

`r writer(record[['Habitat']])`. `r record[['physical_environ']]` \par
Veg.: `r species_font(record[['Vegetation']])` `r associates_writer(record[['Associates']])`
`r writer(record[['Notes']])`  
\endgroup

\vspace{\fill} 

\noindent
\begin{minipage}[t]{0.75\textwidth}
  \begingroup 
  `r collection_writer(record)`
  `r writer_fide(record)`
  \endgroup
\end{minipage}
\hfill
\begin{minipage}[b]{0.2\textwidth}
  \includegraphics[width=\linewidth,keepaspectratio]{`r logopath`}
\end{minipage}
